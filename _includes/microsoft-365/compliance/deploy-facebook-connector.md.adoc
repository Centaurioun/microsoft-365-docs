= Deploy a connector to archive Facebook Business pages data
:ROBOTS: NOINDEX, NOFOLLOW
:audience: Admin
:author: robmazz
:description: Administrators can set up a native connector to import and archive Facebook Business pages to Microsoft 365. After this data is imported to Microsoft 365, you can use compliance features such as legal hold, content search, and retention policies to manage the governance of your organization's Facebook data.
:f1.keywords: ["NOCSH"]
:manager: laurawi
:ms.author: robmazz
:ms.collection: ["tier1", "M365-security-compliance", "data-connectors"]
:ms.custom: admindeeplinkCOMPLIANCE
:ms.date:
:ms.localizationpriority: medium
:ms.service: O365-seccomp
:ms.topic: article
:search.appverid: ["MET150"]

== Deploy a connector to archive Facebook Business pages data

This article contains the step-by-step process to deploy a connector that uses the Office 365 Import service to import data from Facebook Business pages to Microsoft 365.
For a high-level overview of this process and a list of prerequisites required to deploy a Facebook connector, see xref:archive-facebook-data-with-sample-connector.adoc[Set up a connector to archive Facebook data].

=== Step 1: Create an app in Azure Active Directory

. Go to https://portal.azure.com and sign in using the credentials of a global admin account.
+
image::../media/FBCimage1.png[Create app in AAD.]

. In the left navigation pane, click *Azure Active Directory*.
+
image::../media/FBCimage2.png[Click Azure Active Directory.]

. In the left navigation pane, click *App registrations (Preview)* and then click *New registration*.
+
image::../media/FBCimage3.png[Click **App registrations (Preview)** and then click **New registration**.]

. Register the application.
Under Redirect URI, select Web in the application type dropdown list and then type https://portal.azure.com in the box for the URI.
+
image::../media/FBCimage4.png[Register the application.]

. Copy the *Application (client) ID* and *Directory (tenant) ID* and save them to a text file or other safe location.
You use these IDs in later steps.
+
image::../media/FBCimage5.png[Copy the Application ID and Directory ID and save them.]

. Go to *Certificates & secrets for the new app.*
+
image::../media/FBCimage6.png[Go to Certificates & secrets for the new app.]

. Click *New client secret*
+
image::../media/FBCimage7.png[Click New client secret.]

. Create a new secret.
In the description box, type the secret and then choose an expiration period.
+
image::../media/FBCimage8.png[Type the secret and then choose an expiration period.]

. Copy the value of the secret and save it to a text file or other storage location.
This is the AAD application secret that you use in later steps.
+
image::../media/FBCimage9.png[Copy the value of the secret and save it.]

=== Step 2: Deploy the connector web service from GitHub to your Azure account

. Go to https://github.com/microsoft/m365-sample-connector-csharp-aspnet[this GitHub site] and click *Deploy to Azure*.
+
image::../media/FBCGithubApp.png[Click Deploy to Azure.]

. After you click *Deploy to Azure*, you will be redirected to an Azure portal with a custom template page.
Fill in the *Basics* and *Settings* details and then click *Purchase*.
 ** *Subscription:* Select your Azure subscription that you want to deploy the Facebook Business pages connector web service to.
 ** *Resource group:* Choose or create a new resource group.
A resource group is a container that holds related resources for an Azure solution.
 ** *Location:* Choose a location.
 ** *Web App Name:* Provide a unique name for the connector web app.
Th name must be between 3 and 18 characters in length.
This name is used to create the Azure app service URL;
for example, if you provide the Web app name of *fbconnector* then the Azure app service URL  will be *fbconnector.azurewebsites.net*.
 ** *tenantId:* The tenant ID of your Microsoft 365 organization that you copied after creating the Facebook connector app in Azure Active Directory in Step 1.
 ** *APISecretKey:* You can type any value as the secret.
This is used to access the connector web app in Step 5.
+
image::../media/FBCimage12.png[Click Create a resource and type storage account.]
. After the deployment is successful, the page will look similar to the following screenshot:
+
image::../media/FBCimage13.png[Click Storage and then click Storage account.]

=== Step 3: Register the Facebook app

. Go to https://developers.facebook.com, log in using the credentials for the account for your organization's Facebook Business pages, and then click *Add New App*.
+
image::../media/FBCimage25.png[Add a new app for Facebook business page.]

. Create a new app ID.
+
image::../media/FBCimage26.png[Create a new app ID.]

. In the left navigation pane, click *Add Products* and then click *Set Up* in the *Facebook Login* tile.
+
image::../media/FBCimage27.png[Click Add Products.]

. On the Integrate Facebook Login page, click *Web*.
+
image::../media/FBCimage28.png[Click Web on the Integrate Facebook Login page.]

. Add the Azure app service URL;
for example `+https://fbconnector.azurewebsites.net+`.
+
image::../media/FBCimage29.png[Add the Azure app service URL.]

. Complete the QuickStart section of the Facebook Login setup.
+
image::../media/FBCimage30.png[Complete the QuickStart section.]

. In the left navigation pane under *Facebook Login*, click *Settings*, and add the OAuth redirect URI in the *Valid OAuth Redirect URIs* box.
Use the format *<connectorserviceuri>/Views/FacebookOAuth*, where the value for connectorserviceuri is the Azure app service URL for your organization;
for example, `+https://fbconnector.azurewebsites.net+`.
+
image::../media/FBCimage31.png[Add the OAuth redirect URI to the Valid OAuth Redirect URIs box.]

. In the left navigation pane, click *Add Products* and then click *Webhooks.* In the *Page* pull-down menu, click *Page*.
+
image::../media/FBCimage32.png[Click Add Products and then click **Webhooks.]

. Add Webhooks Callback URL and add a verify token.
The format of the callback URL, use the format `<connectorserviceuri>/api/FbPageWebhook`, where the value for connectorserviceuri is the Azure app service URL for your organization;
for example `+https://fbconnector.azurewebsites.net+`.
+
The verify token should similar to a strong password.
Copy the verify token to a text file or other storage location.
+
image::../media/FBCimage33.png[Add the verify token.]

. Test and subscribe to the endpoint for feed.
+
image::../media/FBCimage34.png[Test and subscribe to the endpoint.]

. Add a privacy URL, app icon, and business use.
Also, copy the app ID and app secret to a text file or other storage location.
+
image::../media/FBCimage35.png[Add a privacy URL, app icon, and business use.]

. Make the app public.
+
image::../media/FBCimage36.png[Make the app public.]

. Add user to the admin or tester role.
+
image::../media/FBCimage37.png[Add user to the admin or tester role.]

. Add the *Page Public Content Access* permission.
+
image::../media/FBCimage38.png[dd the Page Public Content Access permission.]

. Add Manage Pages permission.
+
image::../media/FBCimage39.png[Add Manage Pages permission.]

. Get the application reviewed by Facebook.
+
image::../media/FBCimage40.png[Get the application reviewed by Facebook.]

=== Step 4: Configure the connector web app

. Go to `https://<AzureAppResourceName>.azurewebsites.net` (where AzureAppResourceName is the name of your Azure app resource that you named in Step 4).
For example, if the name is *fbconnector*, go to `+https://fbconnector.azurewebsites.net+`.
The home page of the app will look like the following screenshot:
+
image::../media/FBCimage41.png[Go to you connector web app.]

. Click *Configure* to display a sign in page.
+
image::../media/FBCimage42.png[Click Configure to display a sign in page.]

. In the Tenant Id box, type or paste your tenant Id (that you obtained in Step 2).
In the password box, type or paste the APISecretKey (that you obtained in Step 2), and then click *Set Configuration Settings* to display the configuration details page.
+
image::../media/FBCimage43.png[Sign in using your tenant Id and password and go to configuration details page.]

. Enter the following configuration settings
 ** *Facebook application ID:* The app ID for the Facebook application that you obtained in Step 3.
 ** *Facebook application secret:* The app secret for the Facebook application that you obtained in Step 3.
 ** *Facebook webhooks verify token:* The verify token that you created in Step 3.
 ** *AAD application ID:* The application ID for the Azure Active Directory app that you created in Step 1.
 ** *AAD application secret:* The value for the APISecretKey secret that you created in Step 1.
. Click *Save* to save the connector settings.

=== Step 5: Set up a Facebook connector in the compliance portal

. Go to the Microsoft Purview compliance portal, and then select https://go.microsoft.com/fwlink/p/?linkid=2173865[*Data connectors*</a.]
. On the *Data connectors* page under *Facebook Business pages*, click *View*.
. On the *Facebook business pages* page, click *Add connector*.
. On the *Terms of service* page, click *Accept*.
. On the *Add credentials for your connector app* page, enter the following information and then click *Validate connection*.
+
image::../media/TCimage38.png[Enter connector app credentials.]

 ** In the *Name* box, type a name for the connector, such as *Facebook news page*.
 ** In the *Connection URL* box, type or paste the Azure app service URL;
for example `+https://fbconnector.azurewebsites.net+`.
 ** In the *Password* box, type or paste the value of the APISecretKey that you added in Step 2.
 ** In the *Azure App ID* box, type or paste the value of the Application (client) ID also called as AAD Application ID that you created in Step 1.

. After the connection is successfully validated, click *Next*.
. On the *Authorize Microsoft 365 to import data* page, type or paste the APISecretKey again and then click *Login web app*.
. On the *Configure Facebook connector app* page, click *Login with Facebook* and log in using the credentials for the account for your organization's Facebook Business pages.
Make sure the Facebook account that you logged in to is assigned the admin role for your organization's Facebook Business pages.
+
image::../media/FBCimage50.png[Log in with Facebook.]

. A list of the business pages managed by the Facebook account that you logged in to is displayed.
Select the page to archive and then click *Next*.
+
image::../media/FBCimage52.png[Select the organization business page that you want to archive.]

. Click *Continue* to exit the setup of the connector service app.
. On the *Set filters* page, you can apply a filter to initially import items that are a certain age.
Select an age, and then click *Next*.
. On the *Choose storage location* page, type the email address of Microsoft 365 mailbox that the Facebook items will be imported to, and then click *Next*.
. Click *Next* to review the connector settings and then click *Finish* to complete the connector setup.
. In the compliance center, go to the *Data connectors* page, and click the *Connectors* tab to see the progress of the import process.
