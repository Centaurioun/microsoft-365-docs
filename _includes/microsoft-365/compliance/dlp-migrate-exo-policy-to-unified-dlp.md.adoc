= Migrate Exchange Online DLP policies to Compliance center
:audience: ITPro
:author: chrfox
:description: Learn how to plan for and migrate your Exchange online data loss prevention policies into DLP.
:f1.keywords: ["CSH"]
:f1_keywords: ["ms.o365.cc.DLPLandingPage"]
:manager: laurawi
:ms.author: chrfox
:ms.collection: ["M365-security-compliance", "SPO_Content"]
:ms.date:
:ms.localizationpriority: medium
:ms.service: O365-seccomp
:ms.topic: article
:search.appverid: ["MET150"]

== Migrate Exchange Online data loss prevention policies to Microsoft Purview compliance portal

link:/exchange/security-and-compliance/data-loss-prevention/data-loss-prevention[Exchange Online data loss prevention (DLP) policies] are being deprecated.
xref:dlp-learn-about-dlp.adoc[Much richer DLP functionality], including Exchange Online DLP, is offered in the https://compliance.microsoft.com/datalossprevention?viewid=policies[Microsoft Purview compliance portal].
You can use the DLP policy migration wizard to help you bring your Exchange Online DLP policies over to the Compliance center where you'll manage them.

The migration wizard works by reading the configuration of your DLP policies in Exchange and then creating duplicate policies in the Compliance center.
By default the wizard creates the new versions of the policies in *Test* mode, so you can see what impact they'd have in your environment without enforcing any of the actions.
Once you're ready to fully transition to the Compliance center versions, *_you must_*:

. Deactivate or delete the source policy in the Exchange Admin Center (EAC).
. Edit the Compliance center version of the policy and change its status from *Test* to *Enforce*.

____
[!WARNING] If you do not delete or deactivate the source policy in the EAC before you set the Compliance center version to *Enforce* both sets of policies will be attempting to enforce actions and you will receive duplicate events.
*_This is an unsupported configuration._*
____

The migration wizard only migrates EXO policies and associated mail flow rules.
Standalone Exchange mail flow rules aren't migrated.

=== Migration workflow

There are four phases to migrating DLP policies from Exchange into the Unified DLP management console in the Compliance center.

. Prepare for migration
 .. Evaluate and compare your Exchange Online (EXO) DLP policies and your Compliance Center DLP policies for duplicate functionality.
 .. Decide which EXO DLP policies you want to bring over exactly as they are, you can use the wizard to migrate these.
 .. Decide which EXO DLP policies you want to consolidate and consolidate them in the Exchange admin center, then use the migration wizard to bring them over into the Compliance center.
. Perform the migration - use the wizard
. Testing and validation -  examine the results
. Activate the migrated policies

=== Before you begin

==== Licensing and versions

Before you get started with migrating DLP policies, you should confirm your https://www.microsoft.com/microsoft-365/compare-microsoft-365-enterprise-plans?rtc=1[Microsoft 365 subscription] and any add-ons.

To access and use the policy migration wizard, you must have one of these subscriptions or add-ons

* Microsoft 365 E3
* Microsoft 365 E5
* Microsoft 365 A5 (EDU)
* Microsoft 365 E5 compliance
* Microsoft 365 A5 compliance
* Microsoft 365 E5 information protection and governance
* Microsoft 365 A5 information protection and governance

For a detailed list of DLP licensing requirements, see link:/office365/servicedescriptions/microsoft-365-service-descriptions/microsoft-365-tenantlevel-services-licensing-guidance/microsoft-365-security-compliance-licensing-guidance#information-protection[Microsoft 365 Licensing guidance for security & compliance, data loss prevention]

==== Permissions

The account that you use to run the migration wizard must have access to both the Exchange Admin Console DLP page and to the Unified DLP console in the Compliance center.

=== Prepare for migration

. If you are unfamiliar with DLP, the Compliance center DLP console, or the Exchange Admin center DLP console, you should familiarize yourself before attempting a policy migration.
 .. link:/exchange/security-and-compliance/data-loss-prevention/data-loss-prevention[Exchange Online data loss prevention (DLP) policies]
 .. xref:endpoint-dlp-learn-about.adoc[Learn about Endpoint data loss prevention]
 .. xref:create-test-tune-dlp-policy.adoc[Create, Test, and Tune a DLP policy]
. Evaluate your Exchange DLP and Compliance center policies by asking these questions:

|===
| Question | Action | Migration procedure

| Is the policy still needed?
| If not, delete or deactivate it
| don't migrate

| Does it overlap with any other Exchange or Compliance center DLP policies?
| If yes, can you consolidate the overlapping policies?
| - If it overlaps with another Exchange policy, manually create the consolidated DLP policy in the Exchange Admin center, then use the migration wizard.
</br> - If it overlaps with an existing Compliance Center policy, you can modify the existing Compliance center policy to match, don't migrate the Exchange version

| Is the Exchange DLP policy tightly scoped and does it have well-defined conditions, actions, inclusions, and exclusions?
| If yes, it is a good candidate to migrate with the wizard, make note of the policy so that you remember to come back to delete it later
| migrate with the wizard
|===

=== Migration

After you have evaluated all your Exchange and Compliance center DLP policies for need and compatibility, you can use the migration wizard.

. Open the https://compliance.microsoft.com/datalossprevention?viewid=policies[Microsoft Purview compliance portal] DLP console.
. If there are Exchange DLP policies that can be migrated, a banner will appear at the top of the page letting you know.
. Choose *Migrate policies* in the banner to open the migration wizard.
All the Exchange DLP policies are listed.
Previously migrated policies cannot be selected.
. Select the policies you want to migrate.
You can migrate them individually, or in groups using a phased approach or all at once.
Select *Next*.
. Review the flyout pane for any warnings or messages.
Resolve any issues before proceeding.
. Select the mode you want the new Compliance center policy created in, *Active*, *Test*, or *Disabled*.
The default is *Test*.
Select *Next*.
. If desired, you can create more policies that are based on the Exchange DLP policies for other unified DLP locations.
This will result in one new unified DLP policy for the migrated Exchange policy and one new unified DLP policy for any other locations that you pick here.

____
[!IMPORTANT] Any Exchange DLP policy conditions and actions that are not supported by other DLP locations, like Devices, SharePoint, OneDrive, On-premises, MCAS or Teams chat and channel messages will be dropped from the additional policy.
Also, there is pre-work that must be done for the other locations.
See:

* xref:endpoint-dlp-learn-about.adoc[Learn about Endpoint data loss prevention]
* xref:endpoint-dlp-getting-started.adoc[Get started with Endpoint data loss prevention]
* xref:endpoint-dlp-using.adoc[Using Endpoint data loss prevention]
* xref:dlp-on-premises-scanner-learn.adoc[Learn about the data loss prevention on-premises scanner]
* xref:dlp-on-premises-scanner-get-started.adoc[Get started with the data loss prevention on-premises scanner]
* xref:dlp-on-premises-scanner-use.adoc[Use the Microsoft Purview data loss prevention on-premises scanner]
* xref:dlp-use-policies-non-microsoft-cloud-apps.adoc[Use data loss prevention policies for non-Microsoft cloud apps]
____

. Review the migration wizard session settings.
Select *Next*.
. Review the migration report.
Pay attention to any failures involving Exchange mail flow rules.
You can fix them and remigrate the associated policies.

The migrated policies will now appear in the list of DLP policies in the Compliance center DLP console.

=== Common errors and mitigation

|===
| Error message | Reason | Mitigation/Recommended steps

| A compliance policy with name `<Name of the policy>` already exists in scenario(s) `Dlp`.
| It is likely that this policy migration was done earlier and then reattempted in the same session
| Refresh the session to update the list of policies available for migration.
All previously migrated policies should be in the `Already migrated` state.

| A compliance policy with name `<Name of the policy>` already exists in scenario(s) `Hold`.
| A retention policy with the same name exists in the same tenant.
| - Rename the DLP policy in EAC to a different name.
</br> - Retry the migration for the impacted policy.

| `DLP-group@contoso.com` can't be used as a value for the Shared By condition because it's a distribution group or mail-enabled security group.
Use Shared by Member of predicate to detect activities by members of certain groups.
| Transport rules allow groups to be used in the `sender is` condition but unified DLP does not allow it.
| Update the transport rule to remove all group email addresses from the `sender is` condition and add the group to the `sender is a member of` condition if necessary.
Retry the migration for the impacted policy

| Could not find recipient `DLP-group@contoso.com`.
If newly created, retry the operation after sometime.
If deleted or expired please reset with valid values and try again.
| It is likely that the group address used in `sender is a member of` or `recipient is a member of` condition is expired or invalid.
| - Remove/replace all the invalid group email addresses in the transport rule in Exchange admin center.
</br> - Retry the migration for the impacted policy.

| The value specified in `FromMemberOf` predicate must be mail enabled security group.
| Transport rules allow individual users to be used in the `sender is a member of` condition but unified DLP does not allow it.
| - Update the transport rule to remove all individual user email addresses from the `sender is a member of` condition and add the users to the `sender is` condition if necessary.
</br> - Retry the migration for the impacted policy.

| The value specified in `SentToMemberOf` predicate must be mail enabled security group.
| Transport rules allow individual users to be used under the `recipient is a member of` condition but unified DLP does not allow it.
| - Update the transport rule to remove all individual user email addresses from the `recipient is a member of` condition and add the users to the `recipient is` condition if necessary.
</br> - Retry the migration for the impacted policy.

| Using the `<Name of condition>` parameter is supported only for Exchange.
Either remove this parameter or turn on only Exchange location.
| It is likely that another policy with the same name exists in Compliance center with other locations like SPO/ODB/Teams for which the mentioned condition is not supported.
| Rename the DLP policy in Exchange admin center and retry the migration.
|===

=== Testing and validation
// PRATEEK AND AAKASH TO PROVIDE A LIST OF SUPPORTED PREDICATES AND KNOWN ISSUES BEFORE PUBLISHING

Test and review your policies.

. Follow the link:create-test-tune-dlp-policy.md#test-a-dlp-policy[Test a DLP policy] procedures.
. Review the events created by the policy in xref:data-classification-activity-explorer.adoc[Activity explorer].

=== Review the policy matches between Exchange Admin Center DLP and Microsoft Purview Unified DLP

To ensure that the migrated policies behave as expected, you can export the reports from both admin centers and do a comparison of the policy matches.

. Connect to link:/powershell/exchange/connect-to-exchange-online-powershell[Exchange Online PowerShell].
. Export the link:/powershell/module/exchange/get-maildetaildlppolicyreport[EAC DLP report].
You can copy this cmdlet and insert the appropriate values:
+
[,powershell]
----
Get-MailDetailDlpPolicyReport -StartDate <dd/mm/yyyy -EndDate <dd/mm/yyyy> -PageSize 5000 | select Date, MessageId, DlpPolicy, TransportRule -Unique | Export-CSV <"C:\path\filename.csv">
----

. Export the link:/powershell/module/exchange/get-dlpdetailreport[Unified DLP report].
You can copy this cmdlet and insert the appropriate values:
+
[,powershell]
----
Get-DlpDetailReport -StartDate <dd/mm/yyyy> -EndDate <dd/mm/yyyy> -PageSize 5000 | select Date, Location, DlpCompliancePolicy, DlpComplianceRule -Unique | Export-CSV <"C:\path\filename.csv">
----

=== Activate your migrated policies

Once you are satisfied with how your migrated policies are functioning, you can set them to *Enforce*.

. Open the Exchange Admin Center DLP console.
. Deactivate or delete the source policy.
. Open the https://compliance.microsoft.com/datalossprevention?viewid=policies[Microsoft Purview compliance portal] DLP console and select the policy you want to make active to edit it.
. Change the status to *Turn on*.

=== Related articles

* link:/exchange/security-and-compliance/data-loss-prevention/data-loss-prevention[Exchange Online data loss prevention (DLP) policies]
* xref:dlp-learn-about-dlp.adoc[Learn about data loss prevention]
* xref:data-classification-activity-explorer.adoc[Get started with Activity explorer]
* xref:create-test-tune-dlp-policy.adoc[Create, Test, and Tune a DLP policy]
* xref:create-a-dlp-policy-from-a-template.adoc[Create a DLP policy from a template]
* link:/exchange/security-and-compliance/data-loss-prevention/data-loss-prevention[Exchange Online data loss prevention (DLP) policies]
