= Handle errors in advanced hunting for Microsoft 365 Defender
:audience: ITPro
:author: schmurky
:description: Understand errors displayed when using advanced hunting
:f1.keywords: ["NOCSH"]
:keywords: advanced hunting, threat hunting, cyber threat hunting, Microsoft 365 Defender, microsoft 365, m365, search, query, telemetry, schema, kusto, timeout, resources, errors, unknown error, limits, quota, parameter, allocation
:manager: dansimp
:ms.author: maccruz
:ms.collection: m365-security-compliance
:ms.localizationpriority: medium
:ms.mktglfcycl: deploy
:ms.pagetype: security
:ms.service: microsoft-365-security
:ms.sitesec: library
:ms.subservice: m365d
:ms.topic: article
:search.appverid: met150
:search.product: eADQiWindows 10XVcnh

== Handle advanced hunting errors

[!INCLUDE xref:../includes/microsoft-defender.adoc[Microsoft 365 Defender rebranding]]

*Applies to:*

* Microsoft 365 Defender
* Microsoft Defender for Endpoint

Advanced hunting displays errors to notify for syntax mistakes and whenever queries hit xref:advanced-hunting-limits.adoc[predefined quotas and usage parameters].
Refer to the table below for tips on how to resolve or avoid errors.

|===
| Error type | Cause | Resolution | Error message examples

| Syntax errors
| The query contains unrecognized names, including references to nonexistent operators, columns, functions, or tables.
| Ensure references to link:/azure/data-explorer/kusto/query/[Kusto operators and functions] are correct.
Check xref:advanced-hunting-schema-tables.adoc[the schema] for the correct advanced hunting columns, functions, and tables.
Enclose variable strings in quotes so they are recognized.
While writing your queries, use the autocomplete suggestions from IntelliSense.
| `A recognition error occurred.`

| Semantic errors
| While the query uses valid operator, column, function, or table names, there are errors in its structure and resulting logic.
In some cases, advanced hunting identifies the specific operator that caused the error.
| Check for errors in the structure of query.
Refer to link:/azure/data-explorer/kusto/query/[Kusto documentation] for guidance.
While writing your queries, use the autocomplete suggestions from IntelliSense.
| `'project' operator: Failed to resolve scalar expression named 'x'`

| Timeouts
| A query can only run within a xref:advanced-hunting-limits.adoc[limited period before timing out].
This error can happen more frequently when running complex queries.
| xref:advanced-hunting-best-practices.adoc[Optimize the query]
| `Query exceeded the timeout period.`

| CPU throttling
| Queries in the same tenant have exceeded the xref:advanced-hunting-limits.adoc[CPU resources] that have been allocated based on tenant size.
| The service checks CPU resource usage every 15 minutes and daily and displays warnings after usage exceeds 10% of the allocated quota.
If you reach 100% utilization, the service blocks queries until after the next daily or 15-minute cycle.
xref:advanced-hunting-best-practices.adoc[Optimize your queries to avoid hitting CPU quotas]
| - `This query used X% of your organization's allocated resources for the current 15 minutes.` + - `You have exceeded processing resources allocated to this tenant.
You can run queries again in <duration>.`

| Result size limit exceeded
| The aggregate size of the result set for the query has exceeded the maximum size.
This error can occur if the result set is so large that truncation at the 10,000-record limit can't reduce it to an acceptable size.
Results that have multiple columns with sizable content are more likely to be impacted by this error.
| xref:advanced-hunting-best-practices.adoc[Optimize the query]
| `Result size limit exceeded.
Use "summarize" to aggregate results, "project" to drop uninteresting columns, or "take" to truncate results.`

| Excessive resource consumption
| The query has consumed excessive amounts of resources and has been stopped from completing.
In some cases, advanced hunting identifies the specific operator that wasn't optimized.
| xref:advanced-hunting-best-practices.adoc[Optimize the query]
| -`Query stopped due to excessive resource consumption.` + -`Query stopped.
Adjust use of the <operator name> operator to avoid excessive resource consumption.`

| Unknown errors
| The query failed because of an unknown reason.
| Try running the query again.
Contact Microsoft through the portal if queries continue to return unknown errors.
| `An unexpected error occurred during query execution.
Please try again in a few minutes.`
|===

=== Related topics

* xref:advanced-hunting-best-practices.adoc[Advanced hunting best practices]
* xref:advanced-hunting-limits.adoc[Quotas and usage parameters]
* xref:advanced-hunting-schema-tables.adoc[Understand the schema]
* link:/azure/data-explorer/kusto/query/[Kusto Query Language overview]
