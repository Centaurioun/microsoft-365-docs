= How to use Power Automate Connector to set up a Flow for events
:audience: ITPro
:author: mjcaparas
:description: Use Microsoft Defender for Endpoint Flow connector to create a flow that will be triggered any time a new event occurs on your tenant.
:keywords: flow, supported apis, api, Microsoft flow, query, automation, power automate
:manager: dansimp
:ms.author: macapara
:ms.collection: M365-security-compliance
:ms.custom: api
:ms.localizationpriority: medium
:ms.mktglfcycl: deploy
:ms.pagetype: security
:ms.reviewer:
:ms.service: microsoft-365-security
:ms.sitesec: library
:ms.subservice: mde
:ms.topic: how-to
:search.appverid: met150

== How to use Power Automate Connector to set up a Flow for events

[!INCLUDE xref:../../includes/microsoft-defender.adoc[Microsoft 365 Defender rebranding]]

*Applies to:*

* https://go.microsoft.com/fwlink/p/?linkid=2154037[Microsoft Defender for Endpoint Plan 1]
* https://go.microsoft.com/fwlink/p/?linkid=2154037[Microsoft Defender for Endpoint Plan 2]
* https://go.microsoft.com/fwlink/?linkid=2118804[Microsoft 365 Defender]

____
Want to experience Microsoft Defender for Endpoint?
https://signup.microsoft.com/create-account/signup?products=7f379fee-c4f9-4278-b0a1-e4c8c2fcdf7e&ru=https://aka.ms/MDEp2OpenTrial?ocid=docs-wdatp-exposedapis-abovefoldlink[Sign up for a free trial.]
____

Automating security procedures is a standard requirement for every modern Security Operations Center (SOC).
For SOC teams to operate in the most efficient way, automation is a must.
Use Microsoft Power Automate to help you create automated workflows and build an end-to-end procedure automation within a few minutes.
Microsoft Power Automate supports different connectors that were built exactly for that.

Use this article to guide you in creating automations that are triggered by an event, such as when a new alert is created in your tenant.
Microsoft Defender API has an official Power Automate Connector with many capabilities.

:::image type="content" source="images/api-flow-0.png" alt-text="The Actions page in the Microsoft Defender 365 portal" lightbox="images/api-flow-0.png" :::

____
[!NOTE] For more details about premium connectors licensing prerequisites, see link:/power-automate/triggers-introduction#licensing-for-premium-connectors[Licensing for premium connectors].
____

=== Usage example

The following example demonstrates how to create a Flow that is triggered any time a new Alert occurs on your tenant.
You'll be guided on defining what event starts the flow and what next action will be taken when that trigger occurs.

. Log in to https://flow.microsoft.com[Microsoft Power Automate].
. Go to *My flows* > *New* > *Automated-from blank*.
+
:::image type="content" source="images/api-flow-1.png" alt-text="The New flow pane under My flows menu item in the Microsoft Defender 365 portal" lightbox="images/api-flow-1.png":::

. Choose a name for your Flow, search for "Microsoft Defender ATP Triggers" as the trigger, and then select the new Alerts trigger.
+
:::image type="content" source="images/api-flow-2.png" alt-text=" The Choose your flow's trigger section in the Microsoft Defender 365 portal" lightbox="images/api-flow-2.png" :::

Now you have a Flow that is triggered every time a new Alert occurs.

:::image type="content" source="images/api-flow-3.png" alt-text="A trigger description" lightbox="images/api-flow-3.png":::

All you need to do now is choose your next steps.
For example, you can isolate the device if the Severity of the Alert is High and send an email about it.
The Alert trigger provides only the Alert ID and the Machine ID.
You can use the connector to expand these entities.

==== Get the Alert entity using the connector

. Choose *Microsoft Defender ATP* for the new step.
. Choose *Alerts - Get single alert API*.
. Set the *Alert ID* from the last step as *Input*.
+
:::image type="content" source="images/api-flow-4.png" alt-text="The Alerts pane"  lightbox="images/api-flow-4.png":::

==== Isolate the device if the Alert's severity is High

. Add *Condition* as a new step.
. Check if the Alert severity *is equal to* High.
+
If yes, add the *Microsoft Defender ATP - Isolate machine* action with the Machine ID and a comment.
+
:::image type="content" source="images/api-flow-5.png" alt-text="The Actions pane"  lightbox="images/api-flow-5.png":::

. Add a new step for emailing about the Alert and the Isolation.
There are multiple email connectors that are very easy to use, such as Outlook or Gmail.
. Save your flow.

You can also create a *scheduled* flow that runs Advanced Hunting queries and much more!

=== Related topic

* xref:apis-intro.adoc[Microsoft Defender for Endpoint APIs]
