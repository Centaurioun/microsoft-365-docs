= Microsoft 365 for enterprise test environment multi-factor authentication
:audience: ITPro
:author: kelleyvice-msft
:description: Configure multi-factor authentication using text messages sent to a smart phone in your Microsoft 365 for enterprise test environment.
:f1.keywords: ["NOCSH"]
:manager: scotv
:ms.author: kvice
:ms.collection: M365-identity-device-management
:ms.custom: ["TLG", "Ent_TLGs", "seo-marvel-apr2020", "admindeeplinkMAC"]
:ms.date: 12/12/2019
:ms.localizationpriority: medium
:ms.service: microsoft-365-enterprise
:ms.topic: article

== Multi-factor authentication for your Microsoft 365 for enterprise test environment

_This Test Lab Guide can be used for both Microsoft 365 for enterprise and Office 365 Enterprise test environments._

For an additional level of security for signing in to Microsoft 365 or any service or application that uses the Azure AD tenant for your subscription, you can enable Azure AD multi-factor authentication, which requires more than just a username and password to verify an account.

With multi-factor authentication, users are required to acknowledge a phone call, type a verification code sent in a text message, or verify the authentication with an app on their smart phones after correctly entering their passwords.
They can sign in only after this second authentication factor is satisfied.

This article describes how to enable and test text message-based authentication for a specific user account.

Setting up multi-factor authentication for an account in your Microsoft 365 for enterprise test environment involves two phases and a third optional phase:

* <<phase-1-build-out-your-microsoft-365-for-enterprise-test-environment,Phase 1: Build out your Microsoft 365 for enterprise test environment>>
* <<phase-2-enable-and-test-multi-factor-authentication-for-the-user-2-account,Phase 2: Enable and test multi-factor authentication for the User 2 account>>
* <<phase-3-enable-and-test-multi-factor-authentication-with-a-conditional-access-policy,Phase 3: Enable and test multi-factor authentication with a conditional access policy>>

image::../media/m365-enterprise-test-lab-guides/cloud-tlg-icon.png[Test Lab Guides for the Microsoft cloud.]

____
[!TIP] For a visual map to all the articles in the Microsoft 365 for enterprise Test Lab Guide stack, go to link:../downloads/Microsoft365EnterpriseTLGStack.pdf[Microsoft 365 for enterprise Test Lab Guide Stack].
____

=== Phase 1: Build out your Microsoft 365 for enterprise test environment

If you just want to test multi-factor authentication in a lightweight way with the minimum requirements, follow the instructions in xref:lightweight-base-configuration-microsoft-365-enterprise.adoc[Lightweight base configuration].

If you want to test multi-factor authentication in a simulated enterprise, follow the instructions in xref:pass-through-auth-m365-ent-test-environment.adoc[Pass-through authentication].

____
[!NOTE] Testing multi-factor authentication does not require the simulated enterprise test environment, which includes a simulated intranet connected to the internet and directory synchronization for an Active Directory Domain Services (AD DS) forest.
It is provided here as an option so that you can test multi-factor authentication and experiment with it in an environment that represents a typical organization.
____

=== Phase 2: Enable and test multi-factor authentication for the User 2 account

Enable multi-factor authentication for the User 2 account with these steps:

. Open a separate, private instance of your browser, go to the Microsoft 365 admin center (https://portal.microsoft.com), and then sign in with your global administrator account.
. In the left navigation, select *Users* > https://go.microsoft.com/fwlink/p/?linkid=834822[*Active users*].
. In the Active users pane, select *Multi-factor authentication*.
. In the list, select the *User 2* account.
. In the *User 2* section, under *Quick steps*, select *Enable*.
. In the *About enabling multi-factor auth* dialog box, select *Enable multi-factor auth*.
. In the *Updates successful* dialog box, select *Close*.
. On the *Microsoft 365 admin center* tab, select the user account icon in the upper right, and then select *Sign out*.
. Close your browser instance.

Complete the configuration for the User 2 account to use a text message for validation and test it with these steps:

. Open a new, private instance of your browser.
. Go to the https://admin.microsoft.com[Microsoft 365 admin center] and sign in with the User 2 account name and password.
. After signing in, you are prompted to set up the account for more information.
Select *Next*.
. On the *Additional security verification* page:
 ** Select your country or region.
 ** Enter the phone number of the smart phone that will receive text messages.
 ** In *Method*, select *Send me a code by text message*.
. Select *Next*.
. Enter the verification code from the text message received on your smart phone, and then select *Verify*.
. On the *Step 3: Keep your existing applications* page, select *Done*.
. If this is the first time you signed in with the User 2 account, you are prompted to change the password.
Enter the original password and a new password twice, and then select *Update password and sign in*.
Record the new password in a secure location.
+
You should see the Office portal for User 2 on the *Microsoft Office Home* tab of your browser.

=== Phase 3: Enable and test multi-factor authentication with a conditional access policy

_This phase can only be used for a Microsoft 365 for enterprise test environment._

In this phase, you enable multi-factor authentication for the User 3 account using a group and a conditional access policy.

Next, create a new group named MFAUsers and add the User 3 account to it.

. On the *Microsoft 365 admin center* tab, select *Groups* in the left navigation, and then select https://go.microsoft.com/fwlink/p/?linkid=2052855[*Groups*].
. Select *Add a group*.
. In the *Choose a group type* pane, select *Security*, and then select *Next*.
. In the *Set up the basics* pane, select *Create group*, and then select *Close*.
. In the *Review and finish adding group* pane, enter *MFAUsers*, and then select *Next*.
. In the list of groups, select the *MFAUsers* group.
. In the *MFAUsers* pane, select *Members*, and then select *View all and manage members*.
. In the *MFAUsers* pane, select *Add members*, select the *User 3* account, and then select *Save* > *Close* > *Close*.

Next, create a conditional access policy to require multifactor authentication for members of the MFAUsers group.

. In a new tab of your browser, go to https://portal.azure.com.
. Select *Azure Active Directory* > *Security* > *Conditional Access*.
. In the *Conditional access -- Policies* pane, select *New policy*.
. In the *New* pane, enter *MFA for user accounts* in the *Name* box.
. In the *Assignments* section, select *Users and groups*.
. On the *Include* tab of the *Users and groups* pane, select *Select users and groups* > *Users and groups* > *Select*.
. In the *Select* pane, select the *MFAUsers* group, and then select *Select* > *Done*.
. In the *Access controls* section of the *New* pane, select *Grant*.
. In the *Grant* pane, select *Require multi-factor authentication*, and then select *Select*.
. In the *New* pane, select *On* for *Enable policy*, and then select *Create*.
. Close the *Azure portal* and *Microsoft 365 admin center* tabs.

To test this policy, sign out and sign in with the User 3 account.
You should be prompted to configure MFA.
This demonstrates that the MFAUsers policy is being applied.

=== Next step

Explore additional link:m365-enterprise-test-lab-guides.md#identity[identity] features and capabilities in your test environment.

=== See also

xref:deploy-identity-solution-overview.adoc[Deploy identity]

xref:m365-enterprise-test-lab-guides.adoc[Microsoft 365 for enterprise Test Lab Guides]

xref:microsoft-365-overview.adoc[Microsoft 365 for enterprise overview]

link:/microsoft-365-enterprise/[Microsoft 365 for enterprise documentation]
